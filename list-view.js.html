<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>HP Autonomy jsWhatever Source: list-view.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">HP Autonomy jsWhatever</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="abstract-pages.html">js-whatever/js/abstract-pages</a>
						</li>
						
						<li>
							<a href="autoload.html">js-whatever/js/autoload</a>
						</li>
						
						<li>
							<a href="autoload-collection.html">js-whatever/js/autoload-collection</a>
						</li>
						
						<li>
							<a href="autoload-methods.html">js-whatever/js/autoload-methods</a>
						</li>
						
						<li>
							<a href="base-page.html">js-whatever/js/base-page</a>
						</li>
						
						<li>
							<a href="checkbox-modal.html">js-whatever/js/checkbox-modal</a>
						</li>
						
						<li>
							<a href="colour-manager.html">js-whatever/js/colour-manager</a>
						</li>
						
						<li>
							<a href="confirm.html">js-whatever/js/confirm</a>
						</li>
						
						<li>
							<a href="confirm-view.html">js-whatever/js/confirm-view</a>
						</li>
						
						<li>
							<a href="dirty-base-page.html">js-whatever/js/dirty-base-page</a>
						</li>
						
						<li>
							<a href="discrete-plural.html">js-whatever/js/discrete-plural</a>
						</li>
						
						<li>
							<a href="duration-format.html">js-whatever/js/duration-format</a>
						</li>
						
						<li>
							<a href="empty-navbar.html">js-whatever/js/empty-navbar</a>
						</li>
						
						<li>
							<a href="ensure-array.html">js-whatever/js/ensure-array</a>
						</li>
						
						<li>
							<a href="escape-hod-identifier.html">js-whatever/js/escape-hod-identifier</a>
						</li>
						
						<li>
							<a href="escape-regex.html">js-whatever/js/escape-regex</a>
						</li>
						
						<li>
							<a href="escape-with-links.html">js-whatever/js/escape-with-links</a>
						</li>
						
						<li>
							<a href="filtering-collection.html">js-whatever/js/filtering-collection</a>
						</li>
						
						<li>
							<a href="footer.html">js-whatever/js/footer</a>
						</li>
						
						<li>
							<a href="hms-duration-format.html">js-whatever/js/hms-duration-format</a>
						</li>
						
						<li>
							<a href="icontains.html">js-whatever/js/icontains</a>
						</li>
						
						<li>
							<a href="ip-pad.html">js-whatever/js/ip-pad</a>
						</li>
						
						<li>
							<a href="lazy-tab-view.html">js-whatever/js/lazy-tab-view</a>
						</li>
						
						<li>
							<a href="list-item-view.html">js-whatever/js/list-item-view</a>
						</li>
						
						<li>
							<a href="list-view.html">js-whatever/js/list-view</a>
						</li>
						
						<li>
							<a href="listenable.html">js-whatever/js/listenable</a>
						</li>
						
						<li>
							<a href="location.html">js-whatever/js/location</a>
						</li>
						
						<li>
							<a href="memory-format.html">js-whatever/js/memory-format</a>
						</li>
						
						<li>
							<a href="model-any-changed-attribute-listener.html">js-whatever/js/model-any-changed-attribute-listener</a>
						</li>
						
						<li>
							<a href="navigation.html">js-whatever/js/navigation</a>
						</li>
						
						<li>
							<a href="regex-replace.html">js-whatever/js/regex-replace</a>
						</li>
						
						<li>
							<a href="repeater.html">js-whatever/js/repeater</a>
						</li>
						
						<li>
							<a href="select-element.html">js-whatever/js/select-element</a>
						</li>
						
						<li>
							<a href="spinner-utils.html">js-whatever/js/spinner-utils</a>
						</li>
						
						<li>
							<a href="string-ends-with.html">js-whatever/js/string-ends-with</a>
						</li>
						
						<li>
							<a href="substitution.html">js-whatever/js/substitution</a>
						</li>
						
						<li>
							<a href="tab-page.html">js-whatever/js/tab-page</a>
						</li>
						
						<li>
							<a href="tab-view.html">js-whatever/js/tab-view</a>
						</li>
						
						<li>
							<a href="vent-constructor.html">js-whatever/js/vent-constructor</a>
						</li>
						
						<li>
							<a href="wizard-custom.html">js-whatever/js/wizard-custom</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="abstract-pages.AbstractPages.html">js-whatever/js/abstract-pages.AbstractPages</a>
						</li>
						
						<li>
							<a href="autoload.Autoload.html">js-whatever/js/autoload.Autoload</a>
						</li>
						
						<li>
							<a href="autoload-collection.AutoloadCollection.html">js-whatever/js/autoload-collection.AutoloadCollection</a>
						</li>
						
						<li>
							<a href="base-page.BasePage.html">js-whatever/js/base-page.BasePage</a>
						</li>
						
						<li>
							<a href="checkbox-modal.CheckboxModal.html">js-whatever/js/checkbox-modal.CheckboxModal</a>
						</li>
						
						<li>
							<a href="colour-manager.ColourManager.html">js-whatever/js/colour-manager.ColourManager</a>
						</li>
						
						<li>
							<a href="confirm-view.ConfirmView.html">js-whatever/js/confirm-view.ConfirmView</a>
						</li>
						
						<li>
							<a href="dirty-base-page.DirtyBasePage.html">js-whatever/js/dirty-base-page.DirtyBasePage</a>
						</li>
						
						<li>
							<a href="empty-navbar.EmptyNavbar.html">js-whatever/js/empty-navbar.EmptyNavbar</a>
						</li>
						
						<li>
							<a href="filtering-collection.FilteringCollection.html">js-whatever/js/filtering-collection.FilteringCollection</a>
						</li>
						
						<li>
							<a href="footer.Footer.html">js-whatever/js/footer.Footer</a>
						</li>
						
						<li>
							<a href="lazy-tab-view.LazyTabView.html">js-whatever/js/lazy-tab-view.LazyTabView</a>
						</li>
						
						<li>
							<a href="list-item-view.ListItemView.html">js-whatever/js/list-item-view.ListItemView</a>
						</li>
						
						<li>
							<a href="list-view.ListView.html">js-whatever/js/list-view.ListView</a>
						</li>
						
						<li>
							<a href="navigation.Navigation.html">js-whatever/js/navigation.Navigation</a>
						</li>
						
						<li>
							<a href="repeater.Repeater.html">js-whatever/js/repeater.Repeater</a>
						</li>
						
						<li>
							<a href="tab-page.TabPage.html">js-whatever/js/tab-page.TabPage</a>
						</li>
						
						<li>
							<a href="tab-view.TabView.html">js-whatever/js/tab-view.TabView</a>
						</li>
						
						<li>
							<a href="vent-constructor.Vent.html">js-whatever/js/vent-constructor.Vent</a>
						</li>
						
						<li>
							<a href="wizard-custom.WizardCustom.html">js-whatever/js/wizard-custom.WizardCustom</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: list-view.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/*
 * Copyright 2013-2015 Hewlett-Packard Development Company, L.P.
 * Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License.
 */

/**
 * @module js-whatever/js/list-view
 */
define([
    'backbone',
    'js-whatever/js/list-item-view'
], function(Backbone, ListItemView) {

    // TODO: ListViewOptions.useCollectionChange is deprecated and should be removed in a later version
    /**
     * @typedef module:js-whatever/js/list-view.ListView~ListViewOptions
     * @property {Backbone.Collection} collection The collection containing the items to render
     * @property {boolean} [useCollectionChange=true] (Deprecated, use collectionChangeEvents instead) Whether to re-render
     * the associated ItemView when the collection fires a change event. This is more efficient than creating one change
     * listener for each model.
     * @property {Object.&lt;String, String>|Boolean} [collectionChangeEvents=true] If true, re-renders the associated ItemView
     * when the collection fires a change event. If an object, the keys are model attributes to listen to change events
     * for and the values are the names of functions to call on the associated ItemView when they occur. The callbacks
     * are passed the same arguments triggered by the collection. If false, no change listener is created. This is much
     * more efficient than creating one change listener for each model.
     * @property {function} [ItemView=ListItemView] The Backbone.View constructor to instantiate for each model
     * @property {object} [itemOptions={}] The options to pass to the ItemView constructor in addition to the model
     * @property {String[]} [proxyEvents=[]] Events to proxy from ItemViews, prefixed with 'item:'
     * @property {String} [headerHtml] Optional HTML to render at the top of the list.
     * @property {String} [footerHtml] Optional HTML to render at the bottom of the list.
     * @property {number} [maxSize] If defined, caps the number of item views at the value of maxSize
     */
    /**
     * @name module:js-whatever/js/list-view.ListView
     * @desc View representing a Backbone.Collection. Renders one ItemView for each model, and re-renders in response
     * to collection events
     * @constructor
     * @param {module:js-whatever/js/list-view.ListView~ListViewOptions} options
     * @extends Backbone.View
     */
    return Backbone.View.extend(/** @lends module:js-whatever/js/list-view.ListView.prototype */{
        initialize: function(options) {
            this.itemOptions = options.itemOptions || {};
            this.ItemView = options.ItemView || ListItemView;
            this.proxyEvents = options.proxyEvents || [];
            this.footerHtml = options.footerHtml;
            this.headerHtml = options.headerHtml;

            this.maxSize = options.maxSize;

            if (options.maxSize) {
                this.transformedCollection = _.bind(function() {
                    return this.collection.chain().first(options.maxSize)
                }, this)
            }
            else {
                this.transformedCollection = _.constant(this.collection);
            }

            this.views = {};

            this.listenTo(this.collection, 'add', this.onAdd);
            this.listenTo(this.collection, 'remove', this.onRemove);
            this.listenTo(this.collection, 'sort', this.onSort);
            this.listenTo(this.collection, 'reset', this.render);

            var useCollectionChange = _.isUndefined(options.useCollectionChange) ? true : options.useCollectionChange;

            if ((_.isUndefined(options.collectionChangeEvents) && useCollectionChange) || options.collectionChangeEvents === true) {
                this.listenTo(this.collection, 'change', function(model) {
                    var view = this.views[model.cid];
                    view && view.render();
                });
            } else if (!_.isUndefined(options.collectionChangeEvents)) {
                _.each(options.collectionChangeEvents, function(methodName, attribute) {
                    this.listenTo(this.collection, 'change:' + attribute, function(model) {
                        var view = this.views[model.cid];
                        view && view[methodName].apply(view, arguments);
                    });
                }, this);
            }
        },

        render: function() {
            this.removeViews();
            var $fragment = $(document.createDocumentFragment());

            if (this.headerHtml) {
                $fragment.append(this.headerHtml);
                this.$header = $fragment.children().last();
            }

            this.transformedCollection().each(function(model) {
                var view = this.createItemView(model);
                $fragment.append(view.el);
            }, this);

            if (this.footerHtml) {
                var $footer = $(this.footerHtml);
                this.$footer = $footer.first();
                $fragment.append($footer);
            }

            this.$el.html($fragment);
            return this;
        },

        /**
         * @desc Instantiates and renders an ItemView for the given model. Adds it to the map of model cid to ItemView.
         * @param model The model which needs a view
         * @returns {ItemView} The new ItemView
         */
        createItemView: function(model) {
            var view = this.views[model.cid] = new this.ItemView(_.extend({
                model: model
            }, this.itemOptions));

            _.each(this.proxyEvents, function(event) {
                this.listenTo(view, event, function() {
                    this.trigger.apply(this, ['item:' + event].concat(Array.prototype.slice.call(arguments, 0)));
                });
            }, this);

            view.render();
            return view;
        },

        /**
         * @desc Callback called when a model is added to the collection
         * @param {Backbone.Model} model The model added to the collection
         * @param {Backbone.Collection} collection The collection
         */
        onAdd: function(model) {
            // if we have maxSize, is the model in the interesting range
            if (!this.maxSize || this.transformedCollection().indexOf(model).value() >= 0) {
                var view = this.createItemView(model);

                if (this.$footer) {
                    view.$el.insertBefore(this.$footer);
                } else {
                    this.$el.append(view.el);
                }
            }

            // if a model was added in the interesting range, another model may need to be pushed out
            // always false if maxSize is undefined
            if (_.size(this.views) > this.maxSize) {
                _.each(this.views, function(view) {
                    var index = this.collection.indexOf(view.model);

                    if (index >= this.maxSize) {
                        this.removeView(view);
                    }
                }, this)
            }
        },

        /**
         * @desc Callback called when a model is removed from the collection
         * @param {Backbone.Model} model The model that was removed from the collection
         */
        onRemove: function(model) {
            var view = this.views[model.cid];

            if (view) {
                this.removeView(view);
                delete this.views[model.cid];
            }

            if (_.size(this.views) &lt; this.maxSize && this.collection.size() >= this.maxSize) {
                // if we've removed a view, the next model in the collection should have a view made
                var nextModel = this.collection.at(this.maxSize - 1);

                var newView = this.createItemView(nextModel);

                if (this.$footer) {
                    newView.$el.insertBefore(this.$footer);
                } else {
                    this.$el.append(newView.el);
                }
            }
        },

        /**
         * @desc Callback called when the collection is sorted. This will reorder the ItemViews to reflect the new
         * collection order
         */
        onSort: function() {
            var $previous = this.$header;

            this.transformedCollection().each(function(model, index) {
                var view = this.views[model.cid];

                if (view) {
                    if (!this.maxSize || index &lt; this.maxSize) {
                        var $item = view.$el;

                        if ($previous) {
                            $previous = $item.insertAfter($previous);
                        } else {
                            $previous = $item.prependTo(this.$el);
                        }
                    }
                    else if (this.maxSize) {
                        this.removeView(view);
                        delete this.views[model.cid];
                    }
                }
                else if (index &lt; this.maxSize) {
                    var newView = this.createItemView(model);

                    if ($previous) {
                        $previous = newView.$el.insertAfter($previous);
                    } else {
                        $previous = newView.$el.prependTo(this.$el);
                    }
                }
            }, this);
        },

        /**
         * @desc Backbone.View remove method. Also calls each ItemView's remove method.
         */
        remove: function() {
            this.removeViews();
            Backbone.View.prototype.remove.call(this);
        },

        /**
         * Remove the view and stopListening to it
         * @param view The view to remove
         */
        removeView: function(view) {
            view.remove();
            this.stopListening(view);
        },

        /**
         * @desc Call each ItemView's remove method and reset the map of views.
         */
        removeViews: function() {
            _.each(this.views, this.removeView, this);
            this.views = {};
        }
    });

});
</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		Copyright 2013-2015 Hewlett-Packard Development Company, L.P. Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License.
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Fri Oct 28th 09:46 2016 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
